<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–û—Å—Ç–∞—Ç–∫–∏</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
  --bg: #f7f4ef;
  --card: #ffffff;
  --text: #222;
  --accent: #f4b740;
}

body {
  margin: 0;
  padding: 12px;
  font-family: system-ui, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

h2 {
  text-align: center;
  margin-bottom: 10px;
}

#search {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  margin-bottom: 10px;
}

.table {
  background: var(--card);
  border-radius: 12px;
  overflow: hidden;
}

.row {
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #eee;
}

.row:last-child {
  border-bottom: none;
}

.name {
  flex: 1;
  font-size: 14px;
}

.qty input {
  width: 70px;
  padding: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
  text-align: center;
}

button {
  width: 100%;
  margin-top: 14px;
  padding: 14px;
  font-size: 16px;
  border-radius: 14px;
  border: none;
  background: var(--accent);
  font-weight: 600;
}
</style>
</head>

<body>

<h2 id="title">–û—Å—Ç–∞—Ç–∫–∏</h2>

<input id="search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—é">

<div class="table" id="list"></div>

<button onclick="save()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

<script>
const params = new URLSearchParams(window.location.search);
const GROUP = params.get("group") || "kitchen";

document.getElementById("title").innerText =
  GROUP === "kitchen" ? "üßë‚Äçüç≥ –ö—É—Ö–Ω—è" : "üçπ –ë–∞—Ä";

let data = [];
let filtered = [];

fetch(`./webapp_data_${GROUP}.json`)
  .then(r => r.json())
  .then(j => {
    data = j.map(i => ({ ...i, qty: "" }));
    filtered = data;
    render();
  });

function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  filtered.forEach(item => {
    const row = document.createElement("div");
    row.className = "row";

    row.innerHTML = `
      <div class="name">${item.name}</div>
      <div class="qty">
        <input type="number" value="${item.qty}">
      </div>
    `;

    row.querySelector("input").addEventListener("input", e => {
      item.qty = e.target.value;
    });

    list.appendChild(row);
  });
}

document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  filtered = data.filter(i => i.name.toLowerCase().includes(q));
  render();
});

async function save() {
  const payload = JSON.stringify(
    data.map(i => ({
      name: i.name,
      qty: Number(i.qty) || 0
    })),
    null,
    2
  );

  try {
    await navigator.clipboard.writeText(payload);
    alert("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã. –í—Å—Ç–∞–≤—å –∏—Ö –≤ —á–∞—Ç –±–æ—Ç–∞.");
  } catch {
    prompt("–°–∫–æ–ø–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –∏ –≤—Å—Ç–∞–≤—å –≤ Telegram:", payload);
  }
}
</script>

</body>
</html>
