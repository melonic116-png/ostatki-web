<script>
async function loadProducts() {
  try {
    console.log("üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º webapp_data.json...");
    const response = await fetch("./webapp_data.json?nocache=" + Date.now(), {
      headers: { 'Cache-Control': 'no-cache' }
    });
    if (!response.ok) throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å JSON");

    const products = await response.json();
    console.log("‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:", products.length);

    const tbody = document.getElementById("table-body");
    tbody.innerHTML = "";

    products.forEach(item => {
      const row = document.createElement("tr");

      const nameCell = document.createElement("td");
      nameCell.textContent = item.name;

      const qtyCell = document.createElement("td");
      const input = document.createElement("input");
      input.type = "number";
      input.min = "0";
      input.value = item.qty || "";
      qtyCell.appendChild(input);

      row.appendChild(nameCell);
      row.appendChild(qtyCell);
      tbody.appendChild(row);
    });
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON:", error);
    document.getElementById("table-body").innerHTML =
      '<tr><td colspan="2" style="color:red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
  }
}

// –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
loadProducts();

// –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
document.querySelector("form").addEventListener("submit", e => {
  e.preventDefault();
  const rows = document.querySelectorAll("#table-body tr");
  const result = [];

  rows.forEach(row => {
    const name = row.children[0].textContent.trim();
    const qty = row.children[1].children[0].value || "0";
    result.push({ name, qty: Number(qty) });
  });

  const json = JSON.stringify(result, null, 2);
  navigator.clipboard.writeText(json);
  alert("‚úÖ JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. –í—Å—Ç–∞–≤—å –µ–≥–æ –≤ —á–∞—Ç –±–æ—Ç–∞.");
});
</script>
